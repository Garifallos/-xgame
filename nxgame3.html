<!doctype html>
<html lang="el">
<head>
<meta charset="UTF-8">
<title>NX CROSSY TIMER</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
html,body{
  margin:0;height:100%;
  background:#050607;
  display:grid;place-items:center;
  font-family:system-ui,Arial;
  color:#eaffea;
}
.game{
  width:360px;height:520px;
  background:#070809;
  border:1px solid #111;
  position:relative;
  overflow:hidden;
}
.ui{
  position:absolute;top:8px;left:0;right:0;
  text-align:center;font-size:12px;
  letter-spacing:2px;opacity:.85;
}
.timerbar{
  position:absolute;top:32px;left:20px;
  width:320px;height:6px;
  background:#111;border-radius:999px;
  overflow:hidden;
}
.timer{height:100%;width:100%;background:#6aff6a}
.player{
  position:absolute;
  width:20px;height:20px;
  background:#6aff6a;
  top:360px;
  box-shadow:0 0 10px rgba(106,255,106,.8);
  transition:top .18s ease-out;
}
.road{
  position:absolute;
  width:100%;height:40px;
  background:#1a1c1e;
  top:200px;
  overflow:hidden;
}
.car{
  position:absolute;
  width:34px;height:20px;
  top:10px;
  background:#ff3b3b;
}
.overlay{
  position:absolute;inset:0;
  background:rgba(5,6,7,.9);
  display:grid;place-items:center;
}
.overlay.hidden{display:none}
button{
  margin-top:12px;
  padding:8px 16px;
  background:#0b0d0e;
  border:1px solid #6aff6a;
  color:#caffca;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="game">
  <div class="ui">SCORE: <span id="score">0</span></div>
  <div class="timerbar"><div class="timer" id="timer"></div></div>

  <div class="road" id="road"></div>
  <div class="player" id="player"></div>

  <div class="overlay" id="overlay">
    <div>
      <div id="msg">← → MOVE • SPACE CROSS</div>
      <button onclick="restart()">RESTART</button>
    </div>
  </div>
</div>

<script>
const road = document.getElementById("road");
const player = document.getElementById("player");
const overlay = document.getElementById("overlay");
const msg = document.getElementById("msg");
const scoreEl = document.getElementById("score");
const timerEl = document.getElementById("timer");

let alive = false;
let score = 0;

let carSpeed = 80;
let timerMax = 2.4;
let timer = timerMax;
let lastTime = 0;

let cars = [];
let animating = false;

let px = 170;
const PLAYER_START_Y = 360;
const PLAYER_CROSS_Y = 180;

const keys = { left:false, right:false };

function rand(a,b){return Math.random()*(b-a)+a;}
function restart(){ location.reload(); }

function die(reason){
  alive = false;
  msg.textContent = `DEAD • ${reason} • SCORE ${score}`;
  overlay.classList.remove("hidden");
}

function resetTimer(){
  timerMax = Math.max(1.0, 2.4 - score*0.07);
  timer = timerMax;
}

function spawnCars(){
  road.innerHTML = "";
  cars = [];

  const gapSize = Math.max(50, 110 - score*6);
  const gapX = rand(40, 360 - gapSize - 40);

  let x = -40;
  while(x < 360){
    if(x > gapX - 34 && x < gapX + gapSize){
      x += gapSize;
      continue;
    }
    const car = document.createElement("div");
    car.className = "car";
    car.style.left = x+"px";
    car.dir = Math.random()<0.5 ? -1 : 1;
    road.appendChild(car);
    cars.push(car);
    x += 40;
  }
}

function start(){
  alive = true;
  overlay.classList.add("hidden");
  score = 0;
  scoreEl.textContent = "0";
  px = 170;
  player.style.left = px+"px";
  carSpeed = 80;
  resetTimer();
  spawnCars();
  lastTime = performance.now();
  requestAnimationFrame(loop);
}

function tryCross(){
  if(animating) return;
  animating = true;

  player.style.top = PLAYER_CROSS_Y + "px";

  setTimeout(()=>{
    for(const car of cars){
      const cx = parseFloat(car.style.left);
      if(Math.abs(cx - px) < 26){
        die("HIT");
        animating = false;
        return;
      }
    }

    score++;
    scoreEl.textContent = score;
    carSpeed += 14;
    resetTimer();
    spawnCars();

    player.style.top = PLAYER_START_Y + "px";
    animating = false;
  }, 180);
}

function loop(t){
  if(!alive) return;
  const dt = (t-lastTime)/1000;
  lastTime = t;

  timer -= dt;
  timerEl.style.width = Math.max(0,(timer/timerMax)*100)+"%";
  if(timer<=0){
    die("TIMER");
    return;
  }

  // lateral movement
  if(keys.left) px -= 200 * dt;
  if(keys.right) px += 200 * dt;
  px = Math.max(0, Math.min(340, px));
  player.style.left = px + "px";

  cars.forEach(car=>{
    let x = parseFloat(car.style.left);
    x += car.dir * carSpeed * dt;
    if(x > 360) x = -40;
    if(x < -40) x = 360;
    car.style.left = x+"px";
  });

  requestAnimationFrame(loop);
}

window.addEventListener("keydown",e=>{
  if(e.code==="ArrowLeft") keys.left = true;
  if(e.code==="ArrowRight") keys.right = true;

  if(e.code==="Space"){
    if(!alive){ start(); return; }
    tryCross();
  }
});
window.addEventListener("keyup",e=>{
  if(e.code==="ArrowLeft") keys.left = false;
  if(e.code==="ArrowRight") keys.right = false;
});
</script>

</body>
</html>
